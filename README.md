# Medusa Source Shopify JSON

Plugin that allows users to source Medusa using a Shopify store or JSON of products coming from Shopify.

It's a fork from `medusa-source-shopify` : https://github.com/medusajs/medusa/tree/master/packages/medusa-source-shopify

## Context: what's the difference?

- I need something smoother and more simple than `updated_at_min` coming from cache: [Original repo method `getAndUpdateBuildTime_`](https://github.com/medusajs/medusa/blob/master/packages/medusa-source-shopify/src/services/shopify.js#L104).
- For dev purposes or just to migrate Shopify one time: I want to be able to use JSON files like `products.json`.
- It's always better if I can dodge working with `Shopify Private Applications` 🐱 !

## Install the plugin

Navigate to your Medusa server (the API, not the admin dashboard) in your terminal, and install the plugin.

```zsh
$ cd my-medusa-server
$ yarn add medusa-source-shopify-json
```

## Fetch from a local JSON

### Download your products

> 💡 `MY_STORE_NAME` is the name of your store.

- Go to: `https://MY_STORE_NAME.myshopify.com/admin/api/unstable/products.json`
- Save this JSON in a `.json` file, like in `./products.json`

Do the same with these 3 urls:
- custom_collections : `https://MY_STORE_NAME.myshopify.com/admin/api/unstable/custom_collections.json`
- smart_collections : `https://MY_STORE_NAME.myshopify.com/admin/api/unstable/smart_collections.json`
- collects_path : `https://MY_STORE_NAME.myshopify.com/admin/api/unstable/collects_path.json`

> 💡 You now have created 4 files inside your applications.

### Add the plugin to your configuration

```js
const plugins = [
  // other plugins...
  {
    resolve: `medusa-source-shopify-json`,
    options: {
      json: {
        products_path: "./products.json",
        custom_collections_path: "./custom_collections.json",
        smart_collections_path: "./smart_collections.json",
        collects_path: "./collects.json"
      }
    }
  }
];
```

## Fetch directly your products from Shopify

### Create a Shopify app

Navigate to your Shopify dashboard, and then go to `Apps` and click the `Develop apps for your store` button at the bottom of the page.
After navigating to the `App development` page, click the `Create an app` in the top right corner.

This should open a modal where you can choose a name for your app. Write a name and click `Create app`.

You should then click the button that says `Configure Admin API scopes`. Scroll down to `Products` and select the `read_products` scope, and then save your changes.

Go back to overview and click `Install app`. This should generate a token, that you should write down as you can only view it once : it's your `password`.

### Add the plugin to your configuration

Update your `medusa-config.js` with the following:

```js
//Shopify keys
const SHOPIFY_STORE_URL = process.env.SHOPIFY_STORE_URL || "";
const SHOPIFY_API_KEY = process.env.SHOPIFY_API_KEY || "";

const plugins = [
  // other plugins...
  {
    resolve: `medusa-source-shopify-json`,
    options: {
      domain: SHOPIFY_STORE_URL,
      password: SHOPIFY_API_KEY,
      updated_after: "2021-01-01"
    }
  }
];
```

You should then add `SHOPIFY_STORE_URL` and `SHOPIFY_API_KEY` to your `.env`.

```env
SHOPIFY_API_KEY=<your_secret_shopify_key>
SHOPIFY_STORE_URL=<your_store_name>
```

The `SHOPIFY_API_KEY` is the token that we generated in the previous step.

`SHOPIFY_STORE_URL` is the name of your store (don't add `myshopify.com` in this variable).
You can view the name in the url of your Shopify dashboard, which has the following format `<your_store_name>.myshopify.com`.

`updated_after` overwrite the autogenerated date from build to fetch all products starting a date.
```js
updated_after: '2022/10/10' //this will fetch products modified since the 10th October of 2022.
```

If you want to disable this feature and fetch things independently of the date, set it to `false`.

```js
updated_after: false;
```

If your remove it, it does like the default behavior:

> The plugin stores everytime it is run, and will use this timestamp to only fetch products, collections and collects that have been updated in Shopify since the last time it pulled data.

## Run your server

After setting everything up you can now run your server

```zsh
$ yarn start
```

and the plugin will handle the rest.

## Note / Limitations

### `Product/Collection` relations (`Collect`)

**(this is the same limitation as in the official plugin)**

Shopify supports products being part of more than one collection, but Medusa does not support this. For this reason a product will only be part of the first collection it has a relation to in Medusa. The plugin processes Shopify product/collection relations in the following order:

1. Custom collections
2. Smart collections

This means that if product `X` is part of custom collection `Y` and smart collection `Z` in Shopify, it will only be added to custom collection `X` in Medusa.
